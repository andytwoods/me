<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Python Zappa + db + external web (setting up VPC) - andytwoods</title><meta name="description" content="In the previous post, we created a project using Django-CookieCutter. We deployed it to AWS Lambda with Python's Zappa, using PyCharm for sanity preservation. Here, we set up AWS to grant our app access to an AWS postgres DB, and to the external internet. Log&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://andytwoods.com/python-zappa-external-web-setting-up-vpc.html"><link rel="amphtml" href="https://andytwoods.com/amp/python-zappa-external-web-setting-up-vpc.html"><link rel="alternate" type="application/atom+xml" href="https://andytwoods.com/feed.xml"><link rel="alternate" type="application/json" href="https://andytwoods.com/feed.json"><meta property="og:title" content=" Python Zappa + db + external web (setting up VPC)"><meta property="og:image" content="https://andytwoods.com/media/posts/2/1_6j17ZDuywkKu7TOa2yvAKg.png"><meta property="og:site_name" content="blog - andytwoods"><meta property="og:description" content="In the previous post, we created a project using Django-CookieCutter. We deployed it to AWS Lambda with Python's Zappa, using PyCharm for sanity preservation. Here, we set up AWS to grant our app access to an AWS postgres DB, and to the external internet. Log&hellip;"><meta property="og:url" content="https://andytwoods.com/python-zappa-external-web-setting-up-vpc.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@andytwoods"><meta name="twitter:title" content=" Python Zappa + db + external web (setting up VPC)"><meta name="twitter:description" content="In the previous post, we created a project using Django-CookieCutter. We deployed it to AWS Lambda with Python's Zappa, using PyCharm for sanity preservation. Here, we set up AWS to grant our app access to an AWS postgres DB, and to the external internet. Log&hellip;"><meta name="twitter:image" content="https://andytwoods.com/media/posts/2/1_6j17ZDuywkKu7TOa2yvAKg.png"><link rel="stylesheet" href="https://andytwoods.com/assets/css/style.css?v=55952819389dc15ff61d1dd050af1906"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://andytwoods.com/python-zappa-external-web-setting-up-vpc.html"},"headline":" Python Zappa + db + external web (setting up VPC)","datePublished":"2019-04-16T16:51","dateModified":"2019-04-16T16:54","image":{"@type":"ImageObject","url":"https://andytwoods.com/media/posts/2/1_6j17ZDuywkKu7TOa2yvAKg.png","height":235,"width":367},"description":"In the previous post, we created a project using Django-CookieCutter. We deployed it to AWS Lambda with Python's Zappa, using PyCharm for sanity preservation. Here, we set up AWS to grant our app access to an AWS postgres DB, and to the external internet. Log&hellip;","author":{"@type":"Person","name":"andy-woods"},"publisher":{"@type":"Organization","name":"andy-woods"}}</script><script async src="https://andytwoods.com/assets/js/lazysizes.min.js?v=739e7d27e1cbc58b1b2e6882674b8867"></script><style>.top__search [type=search] {
						background-image: url(https://andytwoods.com/assets/svg/search.svg);
				    }</style><link rel="shortcut icon" type="image/x-icon" href="favicon.ico"></head><body><div class="container"><header class="js-top is-sticky"><a class="logo" href="https://andytwoods.com/">andytwoods</a><div class="top"><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle">Menu</button><ul class="navbar__menu"></ul></nav><div class="top__search"><form action="https://andytwoods.com/search.html" class="search"><input type="search" name="q" placeholder="search..."></form></div></div></header><main><article class="post"><div class="hero"><div class="hero__wrap"><img class="lazyload blur-up" src="https://andytwoods.com/media/posts/2/responsive/1_6j17ZDuywkKu7TOa2yvAKg-xs.png" data-srcset="https://andytwoods.com/media/posts/2/responsive/1_6j17ZDuywkKu7TOa2yvAKg-xs.png 300w ,https://andytwoods.com/media/posts/2/responsive/1_6j17ZDuywkKu7TOa2yvAKg-sm.png 480w ,https://andytwoods.com/media/posts/2/responsive/1_6j17ZDuywkKu7TOa2yvAKg-md.png 768w ,https://andytwoods.com/media/posts/2/responsive/1_6j17ZDuywkKu7TOa2yvAKg-lg.png 1024w ,https://andytwoods.com/media/posts/2/responsive/1_6j17ZDuywkKu7TOa2yvAKg-xl.png 1360w ,https://andytwoods.com/media/posts/2/responsive/1_6j17ZDuywkKu7TOa2yvAKg-2xl.png 1600w" data-sizes="auto" alt=""></div><header class="hero__text"><h1>Python Zappa + db + external web (setting up VPC)</h1><p class="post__meta"><time datetime="2019-04-16T16:51">16 April 2019</time></p></header></div><div class="post__entry"><p>In the <a href="https://andytwoods.com/python-zappa-django-cookiecutter-via-pycharm.html">previous post</a>, we created a project using Django-CookieCutter. We deployed it to AWS Lambda with Python's Zappa, using PyCharm for sanity preservation.</p><p>Here, we set up AWS to grant our app access to an AWS postgres DB, and to the external internet. </p><p>Log in to AWS, select VPC.</p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/Clipboard_20180504-xs.png" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/Clipboard_20180504-xs.png 300w ,https://andytwoods.com/media/posts/2/responsive/Clipboard_20180504-sm.png 480w ,https://andytwoods.com/media/posts/2/responsive/Clipboard_20180504-md.png 768w" alt="" width="239" height="141"></p><p>Let's start by making an Elastic IP. This just involves clicking 'ok' a few times. Once done, 'Start VPC Wizard'. </p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/4-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/4-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/4-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/4-md.PNG 768w" alt="" width="636" height="596"></p><p>Make sure you select VPC with public and private subnets.</p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/2-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/2-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/2-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/2-md.PNG 768w" alt="" width="1075" height="416"></p><p>To save you from madness, please make sure that your Public and Private subnet zones differ.<strong> It is very easy to miss this! Please dont! </strong>Make sure you select for 'Elastic IP Allocation ID' the Elastic IP you just created.</p><p>Question for someone: are 251 IP addresses per subnet sufficient?</p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/5-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/5-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/5-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/5-md.PNG 768w" alt="" width="772" height="691"></p><p>Wait a bit ;)</p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/6-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/6-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/6-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/6-md.PNG 768w" alt="" width="308" height="109"></p><p>Let's give our app access to some features of AWS. Select Endpoints. Then 'Create Endpoint'. </p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/7-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/7-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/7-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/7-md.PNG 768w" alt="" width="737" height="599"></p><p>Select the Service ending in S3. Make sure to associate it with the private subnet. Regarding 'Policy'. I gave mine 'Full Access'.  Then 'Create Endpoint'. </p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/8-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/8-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/8-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/8-md.PNG 768w" alt="" width="1328" height="1113"></p><p>Because we used the VPC wizard, we have both an Internet Gateway and an NAT Gateway set up for us already. This saves some headache, as it is very important that these are each associated with specific subnets and we dont have to worry now about setting this up OMFG (see <a href="https://edgarroman.github.io/zappa-django-guide/aws_network_primer/">https://edgarroman.github.io/zappa-django-guide/aws_network_primer/ </a>for manual set up).</p><p>Let's copy down the <strong>PRIVATE</strong> subnet IDs (that was created for you by the wizard) and add them to our Zappa_settings.json file. </p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/9-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/9-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/9-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/9-md.PNG 768w" alt="" width="836" height="326"></p><p>Let's do the same for the Security Group that was created.</p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/11-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/11-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/11-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/11-md.PNG 768w" alt="" width="1044" height="596"> </p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/10-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/10-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/10-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/10-md.PNG 768w" alt="" width="599" height="447"></p><p>Finally, let's create a DB in AWS. Go back to the AWS dashboard, under Dabase select RDS. Let's launch a DB instance. Select PostgreSQL, Production.</p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/12-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/12-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/12-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/12-md.PNG 768w" alt="" width="849" height="412"></p><p><br>Note that  AWS autoselect a super expensive DB for you. Make sure to update 'DB instance class'. Specify your DB details such as username and password and add these to your zappa_settings.json file.<img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/13-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/13-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/13-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/13-md.PNG 768w" alt="" width="1000" height="856"></p><p>After, you are confronted with the below screen. Make sure to select the VPC you created before. </p><p>Question: does the zone have to be different from the existing subnets?</p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/14-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/14-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/14-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/14-md.PNG 768w" alt="" width="784" height="666"></p><p>Once created, we need to edit the DB security group, to add some inbound rules. Scroll down to 'Security groups' and click on your db security group.</p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/16-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/16-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/16-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/16-md.PNG 768w" alt="" width="973" height="597"></p><p>Then, we need to add an inbound rule with 'source' being the same security group you entered into your zappa_settings.json file.</p><p><img class="lazyload blur-up" loading="lazy" src="https://andytwoods.com/media/posts/2/responsive/15-xs.PNG" data-sizes="auto" data-srcset="https://andytwoods.com/media/posts/2/responsive/15-xs.PNG 300w ,https://andytwoods.com/media/posts/2/responsive/15-sm.PNG 480w ,https://andytwoods.com/media/posts/2/responsive/15-md.PNG 768w" alt="" width="1295" height="822"></p><p>Let's run <code>zappa update</code> and see what happens.</p><p> </p><p> </p><p> </p><p> </p><p class="post__last-updated">This article was updated on 16 April 2019</p></div><aside class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fandytwoods.com%2Fpython-zappa-external-web-setting-up-vpc.html" class="js-share facebook" title="Share with Facebook" rel="nofollow"><svg class="icon"><use xlink:href="https://andytwoods.com/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fandytwoods.com%2Fpython-zappa-external-web-setting-up-vpc.html&amp;via=@andytwoods&amp;text=%20Python%20Zappa%20%2B%20db%20%2B%20external%20web%20(setting%20up%20VPC)" class="js-share twitter" title="Share with Twitter" rel="nofollow"><svg class="icon"><use xlink:href="https://andytwoods.com/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Fandytwoods.com%2Fpython-zappa-external-web-setting-up-vpc.html&amp;title=%20Python%20Zappa%20%2B%20db%20%2B%20external%20web%20(setting%20up%20VPC)" class="js-share linkedin" title="Share with LinkedIn" rel="nofollow"><svg class="icon"><use xlink:href="https://andytwoods.com/assets/svg/svg-map.svg#linkedin"/></svg></a></aside><footer class="post__footer"><nav class="post__nav"><div class="post__nav__prev">Previous Post<h5><a href="https://andytwoods.com/hack-trick.html" class="inverse" rel="prev">#hack trick: a quick dirty way to avoid human error whilst debugging</a></h5></div></nav><div class="post__related"><h3>Related posts</h3><div class="post__related__wrap"><figure><figcaption><h4><a href="https://andytwoods.com/python-zappa-django-cookiecutter-via-pycharm.html" class="inverse">Python Zappa + django-cookiecutter (via PyCharm)</a></h4><time datetime="2018-05-04T12:15">4 May 2018</time></figcaption></figure></div></div></footer></article><h3>Comments</h3><div id="disqus_thread"></div><script>var disqus_config = function () {
                    this.page.url = 'https://andytwoods.com/python-zappa-external-web-setting-up-vpc.html';
            		this.page.identifier = '2';
                    this.page.title = '  Python Zappa + db + external web (setting up VPC) - andytwoods ';
                };
            
                var disqus_loaded = false;
            
                function publiiLoadDisqus() {
                    if(disqus_loaded) {
                        return false;
                    }
            
                    var top = document.getElementById('disqus_thread').offsetTop;
            
                    if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                        disqus_loaded = true;
            
                        (function () {
                            var d = document, s = d.createElement('script');
                            s.src = '//andytwoods-com.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    }
                }
            
                publiiLoadDisqus();
            
                window.onscroll = function() {
                    publiiLoadDisqus();
                };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></main><footer class="footer"><div class="footer__social"></div><div class="footer__copyright">@andytwoods</div></footer></div><script>var loadCSSFiles = function() {
    		var links = ['https://fonts.googleapis.com/css?family=Roboto:400,700|Roboto+Condensed:400,700&amp;subset=latin-ext'],
    			headElement = document.getElementsByTagName('head')[0],
    			linkElement, i;
    		for (i = 0; i < links.length; i++) {
    			linkElement = document.createElement('link');
    			linkElement.rel = 'stylesheet';
    			linkElement.href = links[i];
    			headElement.appendChild(linkElement);
    		}
    	};
    	var raf = requestAnimationFrame || mozRequestAnimationFrame || webkitRequestAnimationFrame || msRequestAnimationFrame;
    	if (raf) {
    		raf(loadCSSFiles);
    	} else {
    		window.addEventListener('load', loadCSSFiles);
    	}</script><script defer="defer" src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g=" aria-dropeffect="" crossorigin="anonymous"></script><script defer="defer" src="https://andytwoods.com/assets/js/scripts.min.js?v=f37607af05f83050cdcc37ea18bb5ee1"></script></body></html>